<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Code Generator | BixMAX Tools</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: Arial, sans-serif; background: #f2f2f2; padding-top: 70px; }
  header { position: fixed; top: 0; left: 0; width: 100%; background: #007bff; padding: 15px 0; color: #fff; text-align: center; font-size: 22px; font-weight: bold; z-index: 100; box-shadow: 0 3px 6px rgba(0,0,0,0.15); }
  footer { width: 100%; text-align: center; padding: 20px 0; background: #111; color: #ccc; margin-top: 40px; }
  .container { max-width: 350px; background: linear-gradient(0deg, #fff 0%, #f4f7fb 100%); border-radius: 40px; padding: 25px 35px; border: 5px solid #fff; box-shadow: rgba(133, 189, 215, 0.88) 0px 30px 30px -20px; margin: 20px auto; }
  h2 { text-align: center; margin-bottom: 15px; color: #222; }
  .form-group { margin-bottom: 15px; }
  #linkInput, #phoneInput, #messageInput, select, button { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
  .generate { background: #007bff; color: #fff; border: none; transition: 0.2s; }
  button:hover { background: #0056b3; }
  #preview { margin-top: 10px; border: 1px solid #ccc; padding: 5px; display: inline-block; border-radius: 6px; }
  #previewQR { border: 1px solid #ccc; border-radius: 6px; padding: 5px; }
  #preview small { display: block; font-size: 12px; color: #555; text-align: center; }
  #qrcode { margin: 20px 0; text-align: center; display: flex; justify-content: center; align-items: center; }
  .hidden { display: none !important; }
  #downloadBtn, #resetBtn { display: none; width: auto; margin: 10px auto; padding: 10px 20px; }
  #resetBtn { background: #dc3545; }
  #resetBtn:hover { background: #a71d2a; }

  /* FULLSCREEN LOADER */
  #fullscreenLoader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); display: flex; justify-content: center; align-items: center; z-index: 9999; display: none; }
  .loader { --color-one: #ffbf48; --color-two: #be4a1d; --color-three: #ffbf4780; --color-four: #bf4a1d80; --color-five: #ffbf4740; --time-animation: 2s; --size: 1; position: relative; border-radius: 50%; transform: scale(var(--size)); box-shadow: 0 0 25px 0 var(--color-three), 0 20px 50px 0 var(--color-four); animation: colorize calc(var(--time-animation) * 3) ease-in-out infinite; }
  .loader::before { content: ""; position: absolute; top: 0; left: 0; width: 100px; height: 100px; border-radius: 50%; border-top: solid 1px var(--color-one); border-bottom: solid 1px var(--color-two); background: linear-gradient(180deg, var(--color-five), var(--color-four)); box-shadow: inset 0 10px 10px 0 var(--color-three), inset 0 -10px 10px 0 var(--color-four); }
  .loader .box { width: 100px; height: 100px; background: linear-gradient(180deg, var(--color-one) 30%, var(--color-two) 70%); mask: url(#clipping); -webkit-mask: url(#clipping); }
  .loader svg { position: absolute; }
  .loader svg #clipping { filter: contrast(15); animation: roundness calc(var(--time-animation) / 2) linear infinite; }
  .loader svg #clipping polygon { filter: blur(7px); }
  .loader svg #clipping polygon:nth-child(1){ transform-origin: 75% 25%; transform: rotate(90deg); }
  .loader svg #clipping polygon:nth-child(2){ transform-origin: 50% 50%; animation: rotation var(--time-animation) linear infinite reverse; }
  .loader svg #clipping polygon:nth-child(3){ transform-origin: 50% 60%; animation: rotation var(--time-animation) linear infinite; animation-delay: calc(var(--time-animation) / -3); }
  .loader svg #clipping polygon:nth-child(4){ transform-origin: 40% 40%; animation: rotation var(--time-animation) linear infinite reverse; }
  .loader svg #clipping polygon:nth-child(5){ transform-origin: 40% 40%; animation: rotation var(--time-animation) linear infinite reverse; animation-delay: calc(var(--time-animation) / -2); }
  .loader svg #clipping polygon:nth-child(6){ transform-origin: 60% 40%; animation: rotation var(--time-animation) linear infinite; }
  .loader svg #clipping polygon:nth-child(7){ transform-origin: 60% 40%; animation: rotation var(--time-animation) linear infinite; animation-delay: calc(var(--time-animation) / -1.5); }
  @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  @keyframes roundness { 0%,60%,100%{filter:contrast(15);} 20%,40%{filter:contrast(3);} }
  @keyframes colorize { 0%{filter:hue-rotate(0deg);} 20%{filter:hue-rotate(-30deg);} 40%{filter:hue-rotate(-60deg);} 60%{filter:hue-rotate(-90deg);} 80%{filter:hue-rotate(-45deg);} 100%{filter:hue-rotate(0deg);} }

  /* Floating Balance Button */
   .balance {position: relative; padding: 5px; width: 120px; top: 0; right: 0;  z-index: 999;     background-color: #999cff;
  background-image: radial-gradient(at 85% 51%, hsla(60,60%,61%,1) 0px, transparent 50%),
    radial-gradient(at 74% 68%, hsla(235,69%,77%,1) 0px, transparent 50%),
    radial-gradient(at 64% 79%, hsla(284,72%,73%,1) 0px, transparent 50%),
    radial-gradient(at 75% 16%, hsla(283,60%,72%,1) 0px, transparent 50%),
    radial-gradient(at 90% 65%, hsla(153,70%,64%,1) 0px, transparent 50%),
    radial-gradient(at 91% 83%, hsla(283,74%,69%,1) 0px, transparent 50%),
    radial-gradient(at 72% 91%, hsla(213,75%,75%,1) 0px, transparent 50%);
    width:300px; color:#333;  border-radius:50px;  cursor:pointer; font-weight:bold; }

  /* Top-up Modal */
  #topupModal { position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:1000; }
  #topupModal .modal-content { background:#fff; padding:25px 35px; border-radius:15px; max-width:400px; width:90%; text-align:center; position:relative; }
  #topupModal .modal-content input { width:100%; padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc; }
  #topupModal .modal-content button { padding:10px 20px; margin-top:10px; }
  #topupModal.hidden { display:none !important; }
</style>
</head>
<body>



<!-- FULLSCREEN LOADER -->
<div id="fullscreenLoader">
  <div class="loader">
    <svg width="100" height="100" viewBox="0 0 100 100">
      <defs>
        <mask id="clipping">
          <polygon points="0,0 100,0 100,100 0,100" fill="black"></polygon>
          <polygon points="25,25 75,25 50,75" fill="white"></polygon>
          <polygon points="50,25 75,75 25,75" fill="white"></polygon>
          <polygon points="35,35 65,35 50,65" fill="white"></polygon>
          <polygon points="35,35 65,35 50,65" fill="white"></polygon>
          <polygon points="35,35 65,35 50,65" fill="white"></polygon>
          <polygon points="35,35 65,35 50,65" fill="white"></polygon>
        </mask>
      </defs>
    </svg>
    <div class="box"></div>
  </div>
</div>

<div class="container">
<h2>BixMAX QR Code Generator</h2>
<!-- Floating Balance Button -->
<a class="balance" id="balanceBtn"></a>
<br>
<br>
  <div class="form-group" id="platformGroup">
    <label for="platform">Choose platform:</label>
    <select id="platform">
      <option value="">-- Select --</option>
      <option value="website">URL</option>
      <option value="whatsapp">WhatsApp</option>
    </select>
  </div>
  <div class="form-group" id="bgColorGroup">
    <label>BgColor:</label>
    <input type="color" id="bgColor" value="#ffffff">
  </div>
  <div class="form-group" id="fgColorGroup">
    <label>FgColor:</label>
    <input type="color" id="fgColor" value="#000000">
  </div>
  <div id="preview">
    <div id="previewQR"></div>
    <small>Color Preview</small>
  </div>
  <br><br>
  <div id="websiteInput" class="form-group hidden">
    <label> URL:</label>
    <input type="text" id="linkInput" placeholder="Enter URL">
  </div>
  <div id="whatsappInput" class="hidden">
    <div class="form-group">
      <label>Phone (country code):</label>
      <input type="text" id="phoneInput" placeholder="15551234567">
    </div>
    <div class="form-group">
      <label>Message:</label>
      <input type="text" id="messageInput" placeholder="Enter your message">
    </div>
  </div>
  <button class="generate" id="generateBtn">Generate QR Code</button>
  <div id="qrcode"></div>
  <button id="downloadBtn">Download QR Code</button>
  <button id="resetBtn">Reset</button>
</div>



<!-- Top-up Modal -->
<div id="topupModal" class="hidden">
  <div class="modal-content">
    <h3>Add Funds</h3>
    <input type="number" id="modalTopupAmount" placeholder="Enter amount">
    <button id="modalTopupBtn">Pay</button>
    <button id="modalCloseBtn" style="position:absolute; top:10px; right:10px; background:red; color:#fff; border:none; border-radius:50%; width:30px; height:30px;">&times</button>
  </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.js"></script>
<!-- Include Firebase SDK & Paystack -->
<script src="https://js.paystack.co/v1/inline.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ===== Firebase Config =====
const firebaseConfig = {
    apiKey: "AIzaSyB0BBzQzGX6MHVSjn09VSD-JGpSwOu8EqQ",
    authDomain: "bixmax-6c24c.firebaseapp.com",
    projectId: "bixmax-6c24c",
    storageBucket: "bixmax-6c24c.appspot.com",
    messagingSenderId: "37740442541",
    appId: "1:37740442541:web:a2e2b9bb81c6a8e76c6724"
  };
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ===== QR Code Logic =====
const platformSelect = document.getElementById("platform");
const websiteInputDiv = document.getElementById("websiteInput");
const whatsappInputDiv = document.getElementById("whatsappInput");
const linkInput = document.getElementById("linkInput");
const phoneInput = document.getElementById("phoneInput");
const messageInput = document.getElementById("messageInput");
const bgColorInput = document.getElementById("bgColor");
const fgColorInput = document.getElementById("fgColor");
const generateBtn = document.getElementById("generateBtn");
const qrContainer = document.getElementById("qrcode");
const downloadBtn = document.getElementById("downloadBtn");
const resetBtn = document.getElementById("resetBtn");
const previewQRDiv = document.getElementById("previewQR");
const fullscreenLoader = document.getElementById("fullscreenLoader");
const previewURL = "https://bixmax.store/qrcodes";

function createQRCode(container, text, size=200, fg="#000", bg="#fff") {
  container.innerHTML = "";
  return new QRCode(container, { text, width: size, height: size, colorDark: fg, colorLight: bg });
}
function updatePreview() { createQRCode(previewQRDiv, previewURL, 80, fgColorInput.value, bgColorInput.value); }
updatePreview();

platformSelect.addEventListener("change", () => {
  websiteInputDiv.classList.add("hidden");
  whatsappInputDiv.classList.add("hidden");
  if(platformSelect.value==="website") websiteInputDiv.classList.remove("hidden");
  if(platformSelect.value==="whatsapp") whatsappInputDiv.classList.remove("hidden");
  qrContainer.innerHTML = "";
  downloadBtn.style.display="none";
  generateBtn.style.display="inline-block";
});
[bgColorInput, fgColorInput].forEach(input => input.addEventListener("input", updatePreview));

// ===== Balance Logic =====
const balanceBtn = document.getElementById("balanceBtn");
const topupModal = document.getElementById("topupModal");
const modalCloseBtn = document.getElementById("modalCloseBtn");
const modalTopupBtn = document.getElementById("modalTopupBtn");
const modalTopupAmount = document.getElementById("modalTopupAmount");

let currentUser = null;
let userDocId = null;
let userBalance = 0;

auth.onAuthStateChanged(async user=>{
  currentUser = user;
  if(!user){ balanceBtn.textContent="Sign In"; return; }
  const query = await db.collection("users").where("uid","==",user.uid).limit(1).get();
  if(!query.empty){
    const doc = query.docs[0];
    userDocId = doc.id;
    userBalance = doc.data().balance || 0;
  } else {
    const newDoc = await db.collection("users").add({uid:user.uid, email:user.email, balance:0});
    userDocId = newDoc.id; userBalance=0;
  }
  updateBalanceBtn();
});

function updateBalanceBtn(){ balanceBtn.textContent = currentUser ? `Balance: ${userBalance} GHS` : "Sign In"; }

balanceBtn.addEventListener("click", ()=>{
  if(!currentUser){ window.location.href="https://bixmax.store/auth"; return; }
  topupModal.classList.remove("hidden");
});
modalCloseBtn.addEventListener("click", ()=>topupModal.classList.add("hidden"));
modalTopupBtn.addEventListener("click", ()=>{
  const amount=parseFloat(modalTopupAmount.value);
  if(isNaN(amount)||amount<=0) return alert("Enter valid amount");
  if(!currentUser) return alert("Sign in first");

  const handler = PaystackPop.setup({
    key: "pk_live_55fc4deb5da6100b52f981f9f754dc0249e7752f",
    email: currentUser.email,
    amount: amount*100,
    currency: "GHS",
    ref: "TOPUP-"+Math.floor(Math.random()*1000000000+1),
    callback: function(response){
      alert(amount + " GHS added!");
      userBalance += amount;
      db.collection("users").doc(userDocId).update({balance:userBalance});
      updateBalanceBtn();
      topupModal.classList.add("hidden");
      modalTopupAmount.value="";
    },
    onClose: function(){ alert("Payment cancelled."); }
  });
  handler.openIframe();
});

// ===== QR Generation with balance check =====
generateBtn.addEventListener("click", ()=>{
  if(!currentUser){ alert("Sign in to generate QR"); return; }
  if(userBalance < 30){ topupModal.classList.remove("hidden"); return; }

  let finalText;
  if(platformSelect.value==="website"){ finalText = linkInput.value.trim(); if(!finalText) return alert("Enter a URL"); }
  else if(platformSelect.value==="whatsapp"){
    const phone = phoneInput.value.trim(); const msg = messageInput.value.trim();
    if(!phone||!msg) return alert("Enter phone & message");
    finalText = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
  } else return alert("Select a platform!");

  fullscreenLoader.style.display="flex";
  setTimeout(()=>{
    createQRCode(qrContainer, finalText, 200, fgColorInput.value, bgColorInput.value);
    fullscreenLoader.style.display="none";
    downloadBtn.style.display="inline-block";
    resetBtn.style.display="inline-block";
    generateBtn.style.display="none";
    document.getElementById("platformGroup").classList.add("hidden");
    document.getElementById("bgColorGroup").classList.add("hidden");
    document.getElementById("fgColorGroup").classList.add("hidden");
    document.getElementById("preview").classList.add("hidden");
    websiteInputDiv.classList.add("hidden");
    whatsappInputDiv.classList.add("hidden");

    // Deduct 30 GHS
    userBalance -= 30;
    db.collection("users").doc(userDocId).update({balance:userBalance});
    updateBalanceBtn();
  },1200);
});

downloadBtn.addEventListener("click", ()=>{
  let img = qrContainer.querySelector("img");
  if(!img){ const canvas = qrContainer.querySelector("canvas"); img=new Image(); img.src=canvas.toDataURL("image/png"); }
  const a=document.createElement("a"); a.href=img.src; a.download="qrcode.png"; a.click();
});
resetBtn.addEventListener("click", ()=>location.reload());
</script>
</body>
</html>
