<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dispatch Dashboard | BizMAX</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background: #f2f4f8; }
    header { background: #007BFF; color: white; padding: 1rem 2rem; font-size: 1.5rem; text-align: center; }
    .container { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; padding: 2rem; }
    section { background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    h2 { margin-top: 0; }
    input, select, textarea { width: 100%; margin: 0.5rem 0 1rem; padding: 0.6rem; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #007BFF; color: white; padding: 0.6rem 1.2rem; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .order, .rider { padding: 1rem; border-bottom: 1px solid #eee; }
    .order:last-child, .rider:last-child { border-bottom: none; }
    .status-btns button { margin-right: 0.5rem; margin-bottom: 0.5rem; }
  </style>
</head>
<body>
  <header>BizMAX Dispatch Dashboard</header>
  <div class="container">
    <!-- Rider Registration -->
    <section>
      <h2>Register New Rider</h2>
      <input type="text" id="riderName" placeholder="Full Name" />
      <input type="text" id="riderPhone" placeholder="Phone Number" />
      <input type="email" id="riderEmail" placeholder="Email" />
      <select id="riderVehicle">
        <option value="Bike">Bike</option>
        <option value="Car">Car</option>
        <option value="Van">Van</option>
      </select>
      <button onclick="registerRider()">Register Rider</button>
      <div id="riderList"></div>
    </section><!-- Orders Dashboard -->
<section>
  <h2>Incoming Orders</h2>
  <div id="orders"></div>
</section>

  </div>  <script>
    // Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyB0BBzQzGX6MHVSjn09VSD-JGpSwOu8EqQ",
  authDomain: "bixmax-6c24c.firebaseapp.com",
  projectId: "bixmax-6c24c",
  storageBucket: "bixmax-6c24c.appspot.com",
  messagingSenderId: "37740442541",
  appId: "1:37740442541:web:a2e2b9bb81c6a8e76c6724"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Register Rider
    function registerRider() {
      const name = document.getElementById('riderName').value;
      const phone = document.getElementById('riderPhone').value;
      const email = document.getElementById('riderEmail').value;
      const vehicle = document.getElementById('riderVehicle').value;

      if (!name || !phone) return alert("Name and phone are required");
      const riderId = db.ref("riders").push().key;
      db.ref("riders/" + riderId).set({
        name, phone, email, vehicle, available: true, currentOrder: ""
      });
    }

    // Auto Assign Rider
    function assignRiderToOrder(orderId, orderData) {
      db.ref("riders").once('value', snapshot => {
        const riders = snapshot.val();
        let selectedRiderId = null;

        for (let id in riders) {
          if (riders[id].available) {
            selectedRiderId = id;
            break;
          }
        }

        if (selectedRiderId) {
          db.ref("orders/" + orderId + "/assignedRider").set(selectedRiderId);
          db.ref("riders/" + selectedRiderId).update({ available: false, currentOrder: orderId });
        }
      });
    }

    // Fetch Orders
    db.ref("orders").on('child_added', snapshot => {
      const data = snapshot.val();
      const id = snapshot.key;
      const div = document.createElement("div");
      div.className = "order";
      div.innerHTML = `
        <strong>Customer:</strong> ${data.customerName}<br>
        <strong>Phone:</strong> ${data.customerPhone}<br>
        <strong>Address:</strong> ${data.customerAddress}<br>
        <strong>Items:</strong> ${data.items}<br>
        <strong>Total:</strong> ${data.total}<br>
        <strong>Status:</strong> ${data.status || 'Pending'}<br>
        <strong>Rider:</strong> ${data.assignedRider || 'Unassigned'}<br>
        <div class="status-btns">
          <button onclick="updateStatus('${id}', 'Picked')">Picked</button>
          <button onclick="updateStatus('${id}', 'On the Way')">On the Way</button>
          <button onclick="updateStatus('${id}', 'Delivered')">Delivered</button>
        </div>
      `;
      document.getElementById("orders").prepend(div);

      if (!data.assignedRider) assignRiderToOrder(id, data);
    });

    function updateStatus(orderId, status) {
      db.ref("orders/" + orderId + "/status").set(status);
    }

    // Show Riders
    db.ref("riders").on('value', snapshot => {
      const riders = snapshot.val();
      const list = document.getElementById('riderList');
      list.innerHTML = '<h3>Registered Riders</h3>';
      for (let id in riders) {
        const r = riders[id];
        list.innerHTML += `<div class="rider">
          <strong>${r.name}</strong> - ${r.vehicle} <br>
          ${r.phone} | ${r.email} <br>
          Status: ${r.available ? 'Available' : 'Busy'}
        </div>`;
      }
    });
  </script></body>
</html>