<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="theme-color" content="#00b7d4">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BixMAX Cart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<style>
:root { --brand:#b8860b; --brand-dark:#8b6508; --ink:#1f1f1f; --bg:#f7f7f9; --card:#ffffff; }
*{box-sizing:border-box;}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink);}
a{color:inherit;text-decoration:none;}
header{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:#111;color:#fff;}
.brand{display:flex;align-items:center;gap:10px;} .brand img{height:90px;width:auto;border-radius:6px;}
.nav{display:flex;gap:14px;} .nav a{padding:8px 10px;border-radius:8px;} .nav a:hover{background:rgba(255,255,255,.08);}
.cart-section{padding:26px 16px;max-width:900px;margin:0 auto;background:#fff;border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.06);}
.cart-list{margin:12px 0;}
.cart-item{display:grid;grid-template-columns:64px 1fr auto;align-items:center;gap:10px;margin-bottom:12px;}
.cart-item img{width:64px;height:64px;object-fit:cover;border-radius:8px;}
.qty{display:inline-flex;align-items:center;border:1px solid #ddd;border-radius:10px;overflow:hidden;}
.qty button{background:#f4f4f4;border:0;padding:4px 8px;cursor:pointer;}
button remove {
margin-left: 5px;}
.qty span{min-width:30px;text-align:center;}
.cart-footer{padding:12px;border-top:1px solid #eee;}
.cart-footer .total{display:flex;justify-content:space-between;font-weight:800;margin-bottom:10px;}
.checkout-btn{width:100%;background:#00b7d4;color:#fff;border:0;border-radius:10px;padding:10px 12px;font-weight:700;cursor:pointer;}
footer{padding:24px 16px;text-align:center;background:#111;color:#bbb;margin-top:26px;}

.cart-icon {
  position: relative;
  display: inline-block;
}

.cart-btn {
  position: fixed;
  top: 20px;
  right: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: white;
  text-decoration: none;
  padding: 10px 25px;
  background: linear-gradient(90deg, #00b7d4, #ffb300);
  border-top-left-radius: 50px;
  border-bottom-left-radius: 50px;
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
  box-shadow: 0 4px 15px rgba(255, 136, 0, 0.4);
  z-index: 999;
  transition: all 0.3s ease;
}

/* hover effect */
.cart-btn:hover {
  box-shadow: 0 6px 25px rgba(255, 136, 0, 0.6);
  transform: translateX(-3px);
}

/* counter badge */
#cartCount {
  position: absolute;
  top: -2px;
  right: 17px;
  background: red;
  color: white;
  font-size: 13px;
  font-weight: bold;
  border-radius: 50%;
  padding: 2px 6px;
  box-shadow: 0 0 6px rgba(255,0,0,0.5);
}


.empty-cart {
  text-align: center;
  padding: 50px 20px;
  color: #666;
}

.empty-cart i {
  font-size: 70px;
  color: var(--brand);
  margin-bottom: 15px;
}

.empty-cart h2 {
  font-size: 22px;
  margin-bottom: 8px;
  color: var(--ink);
}

.empty-cart p {
  font-size: 15px;
  margin-bottom: 20px;
}

.empty-cart a {
  display: inline-block;
  background: #00b7d4;
  color: #fff;
  padding: 10px 18px;
  border-radius: 8px;
  font-weight: bold;
  transition: 0.3s;
}

.empty-cart a:hover {
  background: var(--brand-dark);
}
.suggested-products {
  margin-top: 30px;
}

.suggested-products h3 {
  font-size: 18px;
  margin-bottom: 15px;
  color: var(--ink);
}

.suggested-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 16px;
}

.suggested-item {
  background: var(--card);
  border-radius: 10px;
  padding: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,.06);
  text-align: center;
}

.suggested-item img {
  width: 100%;
  height: 120px;
  object-fit: cover;
  border-radius: 8px;
  margin-bottom: 8px;
}

.suggested-item h4 {
  font-size: 15px;
  margin: 6px 0;
}

.suggested-item p {
  font-weight: bold;
  color: #111;
  margin-bottom: 8px;
}

.suggested-item button {
  background: #00b7d4;
  border: 0;
  color: #fff;
  padding: 6px 10px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
}

.suggested-item button:hover {
  background: var(--brand-dark);
}
/* Skeleton loader */
.skeleton {
  background: linear-gradient(90deg, #eee 25%, #f9f9f9 50%, #eee 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

.skeleton-card {
  background: var(--card);
  border-radius: 10px;
  padding: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,.06);
  text-align: center;
}

.skeleton-img {
  width: 100%;
  height: 120px;
  margin-bottom: 8px;
}

.skeleton-text {
  height: 14px;
  margin: 6px 0;
}

.skeleton-btn {
  height: 30px;
  width: 80%;
  margin: 8px auto 0;
  border-radius: 6px;
}
</style>
</head>
<body>
<header>

<div class="cart-icon">
  <a href="/Cart/" class="cart-btn">    
 <a href="/Cart/" class="cart-btn" id="cartIcon">ðŸ›’<span id="cartCount">0</span></a>
  </a>
</div>
</header>

<section class="cart-section">
  <header><strong>ðŸ›’ Your Cart</strong></header>
  <div class="cart-list" id="cartList"></div>
  <div class="cart-footer" id="cartFooter">
  <div class="total"><span>Subtotal</span><span id="subtotal">GHâ‚µ 0</span></div>
 <button class="checkout-btn" onclick="proceedToCheckout()">Proceed to Checkout</button>

</div>
</section>
<div class="suggested-products" id="suggestedProducts"></div>
<footer>
  Â© <span id="year"></span> BixMAX â€” All Rights Reserved.
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

// ðŸ”¥ Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyB0BBzQzGX6MHVSjn09VSD-JGpSwOu8EqQ",
    authDomain: "bixmax-6c24c.firebaseapp.com",
    projectId: "bixmax-6c24c",
    storageBucket: "bixmax-6c24c.appspot.com",
    messagingSenderId: "37740442541",
    appId: "1:37740442541:web:a2e2b9bb81c6a8e76c6724"
  };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ---------------------------
// Suggested products
// ---------------------------
async function renderSuggestions(){
  const container = document.getElementById("suggestedProducts");

  // show skeletons first
  container.innerHTML = `
    <h3>You may also like</h3>
    <div class="suggested-grid">
      ${[1,2,3,4].map(()=>`
        <div class="skeleton-card">
          <div class="skeleton skeleton-img"></div>
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-text" style="width:60%;margin:6px auto;"></div>
          <div class="skeleton skeleton-btn"></div>
        </div>
      `).join("")}
    </div>
  `;

  // fetch from Firestore
  const productsRef = collection(db, "products");
  const snapshot = await getDocs(productsRef);

  let allProducts = [];
  snapshot.forEach(docSnap => {
    allProducts.push({ id: docSnap.id, ...docSnap.data() });
  });

  // Pick random 4
  const shuffled = allProducts.sort(() => 0.5 - Math.random());
  const suggestions = shuffled.slice(0, 4);

  if(suggestions.length === 0){
    container.innerHTML = "";
    return;
  }

  // replace skeletons with real products
  container.innerHTML = `
    <h3>You may also like</h3>
    <div class="suggested-grid">
      ${suggestions.map(p=>`
        <div class="suggested-item">
          <img src="${p.image}" alt="${p.name}">
          <h4>${p.name}</h4>
          <p>GHâ‚µ ${p.price.toFixed(2)}</p>
          <button onclick="addSuggested('${p.id}')">Add to Cart</button>
        </div>
      `).join("")}
    </div>
  `;
}

async function addSuggested(productId){
  const productRef = doc(db, "products", productId);
  const productSnap = await getDoc(productRef);

  if(productSnap.exists()){
    let cart = getCart();
    let product = { id: productSnap.id, ...productSnap.data() };

    let existing = cart.find(item => item.id === product.id);
    if(existing){
      existing.qty++;
    } else {
      cart.push({...product, qty:1});
    }
    saveCart(cart);
    updateBadge(); // refresh badge instantly
  }
}

// ---------------------------
// Cart functions
// ---------------------------
function getCart(){ 
  return JSON.parse(localStorage.getItem("cart"))||[]; 
}

function saveCart(cart){ 
  localStorage.setItem("cart",JSON.stringify(cart)); 
  updateBadge(); 
  renderCart(); 
}

function updateBadge() {
  const cart = getCart();
  const totalQty = cart.reduce((sum, item) => sum + item.qty, 0); 
  document.getElementById("cartCount").textContent = totalQty;
}

function renderCart(){
  const list = document.getElementById("cartList");
  const cart = getCart();
  const footer = document.getElementById("cartFooter");
  list.innerHTML = "";
  let subtotal = 0;

  if(cart.length===0){ 
    list.innerHTML = `
      <div class="empty-cart">
        <i class="fas fa-shopping-cart"></i>
        <h2>Your cart is empty</h2>
        <p>Looks like you havenâ€™t added anything yet.</p>
        <a href="/">Continue Shopping</a>
      </div>`;
    footer.style.display = "none";
  } else {
    footer.style.display = "block";
    cart.forEach((item,i)=>{
      subtotal += item.price*item.qty;
      const div = document.createElement("div");
      div.className = "cart-item";

      // ðŸŸ¡ show size dropdown if fashion item has variation
      let variationHTML = "";
      if (item.category === "Fashion" && item.variation && item.variation !== "none" && item.sizes && item.sizes.length > 0) {
        const selected = item.selectedSize || "";
        variationHTML = `
          <div style="margin-top:6px;">
            <label style="font-size:13px;color:#666;">Select ${item.variation === "number" ? "Size" : "Label"}:</label><br>
            <select onchange="updateSize(${i}, this.value)" style="padding:4px;border-radius:6px;border:1px solid #ccc;">
              <option value="">-- choose --</option>
              ${item.sizes.map(s => `<option value="${s}" ${selected === s ? "selected" : ""}>${s}</option>`).join("")}
            </select>
          </div>`;
      }

      div.innerHTML = `
        <img src="${item.image}" alt="${item.name}">
        <div>
          <strong>${item.name}</strong><br/>
          GHâ‚µ ${item.price.toFixed(2)} each
          ${variationHTML}
        </div>
        <div class="qty">
          <button onclick="decrease(${i})">-</button>
          <span>${item.qty}</span>
          <button onclick="increase(${i})">+</button>
          <button class="remove" style="margin-left:6px;background:#f44336;color:#fff;" onclick="removeItem(${i})">remove</button>
        </div>`;
      list.appendChild(div);
    });
    document.getElementById("subtotal").textContent = "GHâ‚µ "+subtotal.toFixed(2);
  }

  renderSuggestions();
}

// âœ… store selected size
function updateSize(index, value){
  let cart = getCart();
  cart[index].selectedSize = value;
  saveCart(cart);
}

// âœ… validate size before checkout
window.addEventListener("click", e => {
  if(e.target.matches(".checkout-btn")){
    const cart = getCart();
    for(let item of cart){
      if(item.category === "Fashion" && item.variation !== "none" && item.sizes?.length > 0 && !item.selectedSize){
        e.preventDefault();
        alert(`Please select a size for "${item.name}" before checkout.`);
        return;
      }
    }
  }
});

function increase(i){ 
  let cart=getCart(); 
  cart[i].qty++; 
  saveCart(cart); 
}

function decrease(i){ 
  let cart=getCart(); 
  if(cart[i].qty>1){ 
    cart[i].qty--; 
    saveCart(cart); 
  } 
}

function removeItem(i){ 
  let cart=getCart(); 
  cart.splice(i,1); 
  saveCart(cart); 
}

// ---------------------------
// Init
// ---------------------------
document.getElementById("year").textContent = new Date().getFullYear();
renderCart();
updateBadge();

// expose functions to window (needed for inline onclick)
window.addSuggested = addSuggested;
window.increase = increase;
window.decrease = decrease;
window.removeItem = removeItem;
</script>
</body>
</html>
