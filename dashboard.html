<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BixMAX | My Orders</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 0;
    }

    header {
      background: #0077b6;
      color: white;
      padding: 16px;
      text-align: center;
    }

    h1 {
      margin: 0;
      font-size: 24px;
    }

    #orders {
      padding: 20px;
    }

    .order {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .order h3 {
      margin-top: 0;
    }

    .order ul {
      list-style: none;
      padding: 0;
    }

    .order ul li {
      margin: 4px 0;
    }

    #logoutBtn {
      background-color: #ff5252;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      margin: 20px auto;
      display: block;
    }
  </style>
</head>
<body>
  <header>
    <h1>My Orders</h1>
  </header>

  <button id="logoutBtn" onclick="logout()">Logout</button>

  <div id="orders">
    <p>Loading orders...</p>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {  
        apiKey: "AIzaSyB0BBzQzGX6MHVSjn09VSD-JGpSwOu8EqQ",  
        authDomain: "bixmax-6c24c.firebaseapp.com",  
        projectId: "bixmax-6c24c",  
        storageBucket: "bixmax-6c24c.appspot.com",  
        messagingSenderId: "37740442541",  
        appId: "1:37740442541:web:a2e2b9bb81c6a8e76c6724"  
      };  
    firebase.initializeApp(firebaseConfig);

    const db = firebase.firestore();
    const auth = firebase.auth();

    window.onload = function () {
      auth.onAuthStateChanged((user) => {
        if (user) {
          const email = user.email;
          const ordersRef = db.collection("orders").where("email", "==", email);

          ordersRef.get().then((querySnapshot) => {
            const ordersContainer = document.getElementById("orders");
            ordersContainer.innerHTML = "";

            if (querySnapshot.empty) {
              ordersContainer.innerHTML = "<p>No orders found.</p>";
              return;
            }

            querySnapshot.forEach((doc) => {
              const order = doc.data();
              const orderDiv = document.createElement("div");
              orderDiv.classList.add("order");
              orderDiv.innerHTML = `
                <h3>Order ID: ${doc.id}</h3>
                <p><strong>Total:</strong> ₵${order.total}</p>
                <p><strong>Payment:</strong> ${order.payment}</p>
                <p><strong>Date:</strong> ${order.date || "N/A"}</p>
                <p><strong>Items:</strong></p>
                <ul>
                  ${order.items.map(item => `<li>${item.name} × ${item.quantity}</li>`).join("")}
                </ul>
              `;
              ordersContainer.appendChild(orderDiv);
            });
          }).catch((error) => {
            console.error("Error fetching orders:", error);
            document.getElementById("orders").innerHTML = "<p>Error loading orders.</p>";
          });
        } else {
          window.location.href = "auth.html";
        }
      });
    };

    // ✅ Logout button now works correctly
    function logout() {
      firebase.auth().signOut().then(() => {
        window.location.href = "auth.html";
      });
    }
  </script>
</body>
</html>