<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>BixMAX Checkout</title>

  <!-- ───── STYLE ───── -->
  <style>
    :root{
      --blue:#1976d2;
      --green:#28a745;
    }
    body{
      margin:0;font-family:Arial,Helvetica,sans-serif;
      background:lightblue;padding:20px;color:#333;
    }
    .box{
      max-width:600px;margin:auto;background:#fff;padding:24px;
      border-radius:20px;box-shadow:0 0 20px rgba(0,0,0,.15);
    }
    h1,h2{margin:0 0 16px;text-align:center}
    label{display:block;margin:12px 0 6px;font-weight:bold}
    input,textarea,select{
      width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;
    }
    .order-summary{
      background:#f7f7f7;padding:16px;border-radius:14px;margin-bottom:20px
    }
    .order-summary p{margin:6px 0}
    button{
      width:100%;padding:14px;background:var(--blue);color:#fff;
      border:none;border-radius:12px;font-size:16px;font-weight:bold;
      cursor:pointer;transition:background .25s
    }
    button:hover{background:#155a9f}
    footer{text-align:center;margin-top:30px;font-size:14px}

    /* Loader */
    #loaderWrap{
      position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;
      align-items:center;justify-content:center;z-index:1000
    }
    .spinner{
      border:6px solid #f3f3f3;border-top:6px solid var(--blue);
      border-radius:50%;width:50px;height:50px;
      animation:spin 1s linear infinite
    }
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  </style>
</head>
<body>

<div class="box">
  <h1>Checkout</h1>

  <!-- ░░░ ORDER SUMMARY ░░░ -->
  <div class="order-summary">
    <h2>Order Summary</h2>
    <div id="orderItems"></div>
    <h3 style="margin-top:10px">Total: $<span id="grand-total">0.00</span></h3>
  </div>

  <!-- ░░░ CUSTOMER DETAILS ░░░ -->
  <label>Full Name</label>
  <input id="customerName" type="text" placeholder="John Doe" required>

  <label>Email</label>
  <input id="customerEmail" type="email" placeholder="john@example.com" required>

  <label>Phone Number</label>
  <input id="customerPhone" type="tel" placeholder="055 123 4567" required>

  <label>Delivery Address</label>
  <textarea id="customerAddress" rows="3" placeholder="Street, City" required></textarea>

  <!-- ░░░ PAYMENT METHOD ░░░ -->
  <label style="margin-top:14px">Payment Method</label>
  <select id="paymentMethod">
    <option value="delivery">Pay on Delivery</option>
    <option value="online">Pay Online</option>
  </select>

  <!-- ░░░ ACTION BUTTON ░░░ -->
  <button id="checkoutBtn" style="margin-top:22px">Place Order</button>
</div>

<!-- ░░░ LOADER OVERLAY ░░░ -->
<div id="loaderWrap">
  <div>
    <div class="spinner"></div>
    <p style="color:#fff;margin-top:12px;font-weight:bold">Processing…</p>
  </div>
</div>

<footer>&copy; BixMAX 2025. All rights reserved.</footer>

<!-- ───── PAYSTACK SDK ───── -->
<script src="https://js.paystack.co/v1/inline.js"></script>

<!-- ───── MAIN SCRIPT ───── -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ▼ Elements */
  const orderBox    = document.getElementById('orderItems');
  const totalSpan   = document.getElementById('grand-total');
  const paySel      = document.getElementById('paymentMethod');
  const btn         = document.getElementById('checkoutBtn');
  const loader      = document.getElementById('loaderWrap');

  /* ▼ Load cart from localStorage (expects array of {name,qty,price}) */
  const cart   = JSON.parse(localStorage.getItem('cart')||'[]');
  let grand    = 0;
  orderBox.innerHTML='';
  cart.forEach(it=>{
    const line = <p>${it.qty} × ${it.name} — $${(it.qty*it.price).toFixed(2)}</p>;
    orderBox.insertAdjacentHTML('beforeend', line);
    grand += it.qty*it.price;
  });
  totalSpan.textContent = grand.toFixed(2);
  localStorage.setItem('grandTotal', grand.toFixed(2));  // keep in sync/* ▼ Button label change */
  paySel.addEventListener('change', ()=> {
    btn.textContent = paySel.value==='online' ? 'Pay Now' : 'Place Order';
  });

  /* ▼ Click handler */
  btn.addEventListener('click', e=>{
    e.preventDefault();
    if(grand<=0){ alert('Cart is empty.'); return; }

    const name  = document.getElementById('customerName').value.trim();
    const email = document.getElementById('customerEmail').value.trim();
    const phone = document.getElementById('customerPhone').value.trim();
    const addr  = document.getElementById('customerAddress').value.trim();

    if(!name!email!phone||!addr){
      alert('Please fill in all customer details.');
      return;
    }

    if(paySel.value==='online'){
      /* ► Show loader (optional) */
      loader.style.display='flex';

      /* ► Paystack pop-up */
      PaystackPop.setup({
        key: 'pk_test_xxxxxxxxxxxxxxxxxxxxxxx',   // ← replace with your PUBLIC key
        email: email,
        amount: Math.round(grand*100),            // kobo/pesewa
        currency: 'GHS',
        metadata:{custom_fields:[
          {display_name:'Name', value:name},
          {display_name:'Phone', value:phone},
          {display_name:'Address', value:addr}
        ]},
        callback: function(resp){
          loader.style.display='none';
          alert('Payment successful! Ref: '+resp.reference);
          localStorage.removeItem('cart');        // clear cart
          window.location.href='thankyou.html';
        },
        onClose: function(){
          loader.style.display='none';
          alert('Payment was cancelled.');
        }
      }).openIframe();

    } else {
      /* ► Pay on delivery: instant redirect */
      window.location.href='thankyou.html';
    }
  });
});
</script>
</body>
</html>
