<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BizMAX | Checkout</title>
<style>
:root{--blue:#1976d2;--glass:#ffffff26}
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
body{background:lightblue;padding:20px;min-height:100vh}
h1{text-align:center;margin-bottom:20px;color:#000}
.card{max-width:700px;margin:auto;background:var(--glass);
      backdrop-filter:blur(20px);padding:28px;border-radius:20px;
      box-shadow:0 4px 20px rgba(0,0,0,.15)}
.cart-line{display:flex;justify-content:space-between;margin:6px 0;font-size:15px}
.cart-line span:nth-child(1){flex:1}
.cart-line span:nth-child(2){font-weight:bold}
.total{margin-top:14px;font-size:18px;font-weight:bold;text-align:right}
label{display:block;margin-top:14px;margin-bottom:4px;font-weight:bold}
input,textarea,select{width:100%;padding:12px;border-radius:10px;border:none;
      background:rgba(255,255,255,.6);font-size:15px}
.btn{width:100%;padding:16px;border:none;border-radius:12px;
     font-size:17px;font-weight:bold;color:#fff;background:var(--blue);cursor:pointer;margin-top:20px}
.btn:hover{background:#125ca3}
#locBtn{margin-top:8px;background:#555}
#locBtn:hover{background:#333}
.error{color:red;font-size:14px;margin-top:6px}
</style>
</head>
<body>

<h1>Checkout</h1>

<div class="card">
  <!-- Cart summary (inserted by JS) -->
  <div id="cartBox"></div>

  <!-- Customer form -->
  <label>Full Name</label>
  <input id="custName" placeholder="John Doe" required>
  <label>Email</label>
  <input id="custEmail" type="email" placeholder="john@example.com" required>
  <label>Phone Number</label>
  <input id="custPhone" type="tel" placeholder="055 123 4567" required>

  <label>Delivery Address
    <button id="locBtn" type="button" class="btn" style="padding:8px;font-size:14px;width:auto;">
      üìç Use My Location
    </button>
  </label>
  <textarea id="custAddr" rows="3" placeholder="Street ‚Ä¢ City ‚Ä¢ Landmarks" required></textarea>

  <label>Payment Method</label>
  <select id="payMethod">
    <option value="delivery">Pay on Delivery</option>
    <option value="online">Pay Online</option>
  </select>

  <button id="submitBtn" class="btn">Place Order</button>
  <div id="err" class="error"></div>
</div>

<script>
/* ------- 1.  Load cart & fill summary ---------- */
const cart      = JSON.parse(localStorage.getItem('cart')||'[]');
const cartBox   = document.getElementById('cartBox');
let grandTotal  = 0;

if(cart.length===0){
  cartBox.innerHTML='<p style="text-align:center;font-weight:bold">üëú Cart is empty.</p>';
}else{
  cartBox.innerHTML='<h3 style="margin-bottom:8px">Order Summary</h3>';
  cart.forEach(it=>{
     const line=document.createElement('div');
     line.className='cart-line';
     line.innerHTML=<span>${it.qty} √ó ${it.name}</span><span>$${(it.qty*it.price).toFixed(2)}</span>;
     cartBox.appendChild(line);
     grandTotal+=it.qty*it.price;
  });
  const totalDiv=document.createElement('div');
  totalDiv.className='total';
  totalDiv.textContent=Total: $${grandTotal.toFixed(2)};
  cartBox.appendChild(totalDiv);
}

/* ------- 2.  Geolocation -> address field -------- */
document.getElementById('locBtn').onclick=()=>{
  if(!navigator.geolocation){
    alert('Geolocation not supported by this browser'); return;
  }
  navigator.geolocation.getCurrentPosition(pos=>{
     const {latitude,longitude}=pos.coords;
     const addr=document.getElementById('custAddr');
     addr.value=Lat:${latitude.toFixed(5)}, Lng:${longitude.toFixed(5)};
  },err=>{
     alert('Unable to fetch location');
  });
};

/* ------- 3.  Form submit (mailto or alert) ------- */
document.getElementById('submitBtn').onclick=()=>{
  const name =document.getElementById('custName').value.trim();const email=document.getElementById('custEmail').value.trim();
  const phone=document.getElementById('custPhone').value.trim();
  const addr =document.getElementById('custAddr').value.trim();
  const method=document.getElementById('payMethod').value;
  const errDiv=document.getElementById('err');
  errDiv.textContent='';

  if(!name!email!phone||!addr){
     errDiv.textContent='Please fill in all fields.'; return;
  }
  if(cart.length===0){
     errDiv.textContent='Your cart is empty.'; return;
  }

  /*  Build email */
  let body=New BizMAX Order%0D%0A------------------%0D%0A;
  cart.forEach(it=>{
     body+=${it.qty} x ${it.name} = $${(it.qty*it.price).toFixed(2)}%0D%0A;
  });
  body+=------------------%0D%0ATotal: $${grandTotal.toFixed(2)}%0D%0A;
  body+=Payment: ${method}%0D%0A;
  body+=Name: ${name}%0D%0APhone: ${phone}%0D%0AAddress: ${encodeURIComponent(addr)}%0D%0A;
  const mailto=mailto:sales@yourshop.com?subject=New%20Order%20from%20${encodeURIComponent(name)}&body=${body};

  /*  Open mail client */
  window.location.href=mailto;

  /*  Clear cart & redirect  */
  localStorage.removeItem('cart');
  setTimeout(()=>window.location.href='thankyou.html',500);
};

/* ------- 4.  Default button text based on method -- */
document.getElementById('payMethod').onchange=e=>{
  document.getElementById('submitBtn').textContent=
      e.target.value==='online'?'Pay Now':'Place Order';
};
</script>
</body>
</html>
