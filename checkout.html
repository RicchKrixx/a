<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BizMAX | Checkout</title>
<style>
  :root{--blue:#1976d2}
  body{margin:0;font-family:Arial;background:lightblue;padding:20px}
  .box{max-width:620px;margin:auto;background:#fff;padding:24px;
       border-radius:20px;box-shadow:0 0 20px rgba(0,0,0,.12)}
  h1,h2{margin:0 0 18px;text-align:center}
  label{display:block;margin:12px 0 6px;font-weight:bold}
  input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc}
  .summary{background:#f7f7f7;border-radius:14px;padding:16px;margin-bottom:22px}
  .summary p{margin:6px 0}
  button{width:100%;padding:14px;background:var(--blue);color:#fff;border:none;
         border-radius:12px;font-size:16px;font-weight:bold;cursor:pointer}
  button:hover{background:#145aae}
  #loader{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;
          align-items:center;justify-content:center;z-index:1000}
  .spin{width:60px;height:60px;border:7px solid #eee;border-top:7px solid var(--blue);
        border-radius:50%;animation:spin 1s linear infinite}
  @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  footer{text-align:center;margin-top:30px}
</style>
</head>
<body>

<div class="box">
  <h1>Checkout</h1>

  <div class="summary">
    <h2>Order Summary</h2>
    <div id="itemList"></div>
    <p style="margin-top:10px;font-size:18px;font-weight:bold">
      Total: $<span id="grandTotal">0.00</span>
    </p>
  </div>

  <label>Full Name</label><input id="custName"  required>
  <label>Email</label><input id="custEmail" type="email" required>
  <label>Phone</label><input id="custPhone" type="tel"  required>
  <label>Address</label><textarea id="custAddr" rows="3" required></textarea>

  <label>Payment Method</label>
  <select id="payMethod"><option value="delivery">Pay on Delivery</option><option value="online">Pay Online</option></select>

  <button id="actionBtn">Place Order</button>
</div>

<!-- Loader overlay -->
<div id="loader">
  <div style="color:#fff;text-align:center">
    <div class="spin"></div>
    <p style="margin-top:12px;font-weight:bold">Processing…</p>
  </div>
</div>

<footer>&copy; BizMAX 2025</footer>

<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
/* ===== 1.  Load cart & total ===== */
const cart   = JSON.parse(localStorage.getItem('cartItems')||'[]');
const total  = parseFloat(localStorage.getItem('grandTotal')||'0');
document.getElementById('grandTotal').textContent = total.toFixed(2);

const listEl = document.getElementById('itemList');
if(cart.length){ cart.forEach(i=>listEl.insertAdjacentHTML('beforeend',<p>${i.qty} × ${i.name}</p>)); }
else { listEl.innerHTML='<p>No items in cart.</p>'; }

/* ===== 2.  Button label switch ===== */
const sel = document.getElementById('payMethod');
const btn = document.getElementById('actionBtn');
sel.addEventListener('change',()=>btn.textContent=sel.value==='online'?'Pay Now':'Place Order');

/* ===== 3.  Loader helpers ===== */
function showLoader(flag){ document.getElementById('loader').style.display = flag?'flex':'none'; }

/* ===== 4.  Main click ===== */
btn.addEventListener('click', e=>{
  e.preventDefault();
  if(total<=0){alert('Cart is empty.');return;}

  const name  = document.getElementById('custName').value.trim();
  const email = document.getElementById('custEmail').value.trim();
  const phone = document.getElementById('custPhone').value.trim();
  const addr  = document.getElementById('custAddr').value.trim();
  if(!name!email!phone||!addr){alert('Please fill all details.');return;}

  showLoader(true);

  if(sel.value==='online'){
    PaystackPop.setup({
      key:'pk_test_xxxxxxxxxxxxxxxxxxxxxxx',       // ← YOUR PUBLIC KEY
      email, amount:Math.round(total*100), currency:'GHS',
      metadata:{custom_fields:[
        {display_name:'Name', value:name},
        {display_name:'Phone',value:phone},
        {display_name:'Address',value:addr}
      ]},
      callback: r=>{
        alert('Payment success! Ref: '+r.reference);
        localStorage.removeItem('cart');           // clear cart
        window.location='thankyou.html';
      },
      onClose: ()=>{
        showLoader(false);
        alert('Payment cancelled.');
      }
    }).openIframe();

  }else{
    /* Pay on delivery */
    setTimeout(()=>{
      alert('Order placed! We will contact you.');
      localStorage.removeItem('cart');
      window.location='thankyou.html';
    },1200);
  }
});
</script>
</body>
</html>
