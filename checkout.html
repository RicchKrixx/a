<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BizMAX | Checkout</title>
<style>
 :root{--blue:#1976d2;--bg:#e0f7fa}
 *{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif}
 body{background:var(--bg);padding:20px;min-height:100vh}
 h1{text-align:center;margin-bottom:18px}
 .card{max-width:720px;margin:auto;background:#ffffffcc;border-radius:20px;
       padding:28px;box-shadow:0 4px 18px rgba(0,0,0,.15)}
 .item{display:flex;align-items:center;gap:12px;margin:8px 0}
 .item img{width:68px;height:68px;border-radius:12px;object-fit:cover}
 .info h4{margin:0;font-size:15px}
 .info span{font-size:14px;font-weight:bold}
 .total{font-weight:bold;font-size:18px;text-align:right;margin-top:10px}
 label{font-weight:bold;display:block;margin-top:16px}
 input,textarea,select{width:100%;padding:12px;margin-top:5px;border:none;
       border-radius:10px;background:#f4f4f4;font-size:15px}
 #locBtn{margin-top:6px;padding:7px 12px;font-size:13px;
         background:#333;color:#fff;border:none;border-radius:8px;cursor:pointer}
 #locBtn:hover{background:#111}
 #submitBtn{width:100%;margin-top:24px;padding:16px;font-size:17px;font-weight:bold;
            background:var(--blue);color:#fff;border:none;border-radius:12px;cursor:pointer}
 #submitBtn:hover{background:#0f5caf}
 .error{color:red;text-align:center;margin-top:12px;font-weight:bold}
 /* Loader */
 #loader{position:fixed;inset:0;background:rgba(0,0,0,.6);
         display:flex;align-items:center;justify-content:center;z-index:5000;display:none}
 .spinner{width:60px;height:60px;border:6px solid #fff;
          border-top:6px solid var(--blue);border-radius:50%;
          animation:spin 1s linear infinite}
 @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
</style>
</head>
<body>

<h1>Checkout</h1>

<div class="card">
  <!-- Cart items injected here -->
  <div id="cartBox"></div>

  <!-- Customer details -->
  <label>Full Name</label><input id="custName" placeholder="John Doe">
  <label>Email</label><input id="custEmail" type="email" placeholder="john@example.com">
  <label>Phone</label><input id="custPhone" type="tel" placeholder="055 123 4567">

  <label>Delivery Address
    <button id="locBtn" type="button">üìç Use My Location</button>
  </label>
  <textarea id="custAddr" rows="3" placeholder="Street ‚Ä¢ City ‚Ä¢ Landmark"></textarea>

  <!-- Payment -->
  <label>Payment Method</label>
  <select id="payMethod">
    <option value="delivery">Pay on Delivery</option>
    <option value="online">Pay Online</option>
  </select>

  <button id="submitBtn">Place Order</button>
  <div id="err" class="error"></div>
</div>

<!-- Loader -->
<div id="loader"><div class="spinner"></div></div>

<!-- Paystack SDK -->
<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
/* ------- 1. Render Cart & Total -------- */
const cart  = JSON.parse(localStorage.getItem('cart')||'[]');
const box   = document.getElementById('cartBox');
let grand   = 0, totalQty = 0;

function drawCart(){
  if(!cart.length){
    box.innerHTML='<p style="text-align:center;font-weight:bold">üõí Your cart is empty.</p>';
    return;
  }
  box.innerHTML='<h3 style="margin-bottom:8px">Order Summary</h3>';
  cart.forEach(it=>{
    const sub=it.qty*it.price; grand+=sub; totalQty+=it.qty;
    box.insertAdjacentHTML('beforeend',
      <div class="item">
        <img src="${it.image}" alt="${it.name}">
        <div class="info">
          <h4>${it.name}</h4>
          <span>${it.qty} √ó $${it.price.toFixed(2)} = $${sub.toFixed(2)}</span>
        </div>
      </div>);});
  box.insertAdjacentHTML('beforeend',<div class="total">Total: $${grand.toFixed(2)}</div>);
}
drawCart();

/* ------- 2. Geo-location -------- */document.getElementById('locBtn').onclick=()=>{
 if(!navigator.geolocation){alert('Geolocation not supported');return;}
 navigator.geolocation.getCurrentPosition(
   p=>{ const {latitude,longitude}=p.coords;
        document.getElementById('custAddr').value=
          \Lat:\${latitude.toFixed(5)}, Lng:\${longitude.toFixed(5)}\;},
   ()=>alert('Location permission denied.')
 );
};

/* ------- 3. Button label -------- */
const paySel=document.getElementById('payMethod');
const btn   =document.getElementById('submitBtn');
function sync(){btn.textContent=paySel.value==='online'?'Pay Now':'Place Order';}
paySel.onchange=sync; sync();

/* ------- 4. Loader helpers -------- */
const loader=document.getElementById('loader');
function show(b){loader.style.display=b?'flex':'none';}

/* ------- 5. Submit -------- */
btn.onclick=()=>{
  const name =document.getElementById('custName').value.trim();
  const mail =document.getElementById('custEmail').value.trim();
  const tel  =document.getElementById('custPhone').value.trim();
  const addr =document.getElementById('custAddr').value.trim();
  const err  =document.getElementById('err'); err.textContent='';

  if(!name!mail!tel||!addr){err.textContent='Fill all fields.';return;}
  if(!cart.length){err.textContent='Cart empty.';return;}

  const orderID='BMX'+Date.now();

  function finish(){
    /* Save order locally for thank-you & receipt */
    localStorage.setItem('lastOrder', JSON.stringify({
      id:orderID, name, total:grand.toFixed(2), qty:totalQty, items:cart
    }));
    localStorage.removeItem('cart');
    window.location='thankyou.html';
  }

  if(paySel.value==='online'){
    PaystackPop.setup({
      key:'pk_test_xxxxxxxxxxxxxxxxxx',        // <- your public key
      email:mail, amount:Math.round(grand*100), currency:'GHS',
      metadata:{custom_fields:[
        {display_name:'Name',value:name},
        {display_name:'Phone',value:tel},
        {display_name:'Address',value:addr},
        {display_name:'Order ID',value:orderID}
      ]},
      callback: res=>{ show(true); setTimeout(finish,1200); },
      onClose:   ()=>alert('Payment cancelled.')
    }).openIframe();
  }else{
    show(true);
    setTimeout(finish,2000);        // simulate processing delay
  }
};
      localStorage.setItem('grandTotal', newTotal.toFixed(2));
</script>
</body>
</html>
